{"id": "55f960b7-0090-4c52-8c5a-6f9342d4363f", "code": "\"\"\"\nBaseline model for bean yield prediction\n\nReads ./data/train.csv and ./data/test.csv\nwrites predictions to ./result/submission.csv with columns [year, month, state, yield].\n\nThe EVOLVE-BLOCK marks the scope that OpenEvolve is allowed to tune.\n\"\"\"\n\nfrom __future__ import annotations\n\nimport os\nfrom pathlib import Path\n\n# construct real path from judge.py's ROOT\ndef construct_real_path(root):\n    PROJECT_ROOT = Path(root)\n    INPUT_DIR = PROJECT_ROOT\n    OUTPUT_DIR = PROJECT_ROOT.parent / \"outputs\" / \"submission\"\n    OUTPUT_DIR.mkdir(parents=True, exist_ok=True)\n    TRAIN_PATH = INPUT_DIR / \"train.csv\"\n    TEST_PATH = INPUT_DIR / \"test.csv\"\n\n    return TRAIN_PATH, TEST_PATH, OUTPUT_DIR\n\n# EVOLVE-BLOCK-START\nfrom typing import Dict, Tuple\nimport numpy as np\nimport lightgbm as lgb\nimport pandas as pd\n\n\ndef encode_state(df: pd.DataFrame, mapping: Dict[str, int] | None = None) -> Tuple[pd.DataFrame, Dict[str, int]]:\n    df = df.copy()\n    if mapping is None:\n        states = sorted(df[\"state\"].astype(str).unique())\n        mapping = {s: i for i, s in enumerate(states)}\n    df[\"state_enc\"] = df[\"state\"].astype(str).map(mapping).fillna(-1).astype(int)\n    return df, mapping\n\n\ndef add_features(df: pd.DataFrame) -> pd.DataFrame:\n    df = df.copy()\n    m = df[\"month\"].astype(int)\n    # crop-year phase (Oct=0..Sep=11)\n    df[\"months_since_crop_start\"] = np.where(m >= 10, m - 10, m + 2).astype(int)\n    ang = 2.0 * np.pi * (m - 1) / 12.0\n    df[\"month_sin\"] = np.sin(ang)\n    df[\"month_cos\"] = np.cos(ang)\n    df[\"quarter\"] = ((m - 1) // 3 + 1).astype(int)\n    # light interactions\n    df[\"state_x_phase\"] = (df[\"state_enc\"] * df[\"months_since_crop_start\"]).astype(float)\n    return df\n\n\ndef train_and_predict(root) -> Path:\n    train_path, test_path, output_path = construct_real_path(root)\n    train = pd.read_csv(train_path)\n    test = pd.read_csv(test_path)\n\n    train, s2i = encode_state(train)\n    test, _ = encode_state(test, mapping=s2i)\n    train = add_features(train)\n    test = add_features(test)\n\n    # numeric features (keep all original numeric cols + engineered)\n    numeric_kinds = (\"b\", \"i\", \"u\", \"f\", \"c\")\n    features = [c for c in train.columns if c != \"yield\" and train[c].dtype.kind in numeric_kinds]\n\n    X = train[features].copy()\n    X_test = test[features].copy()\n\n    med = X.median(numeric_only=True)\n    X = X.fillna(med)\n    X_test = X_test.fillna(med)\n\n    y = train[\"yield\"].astype(float)\n\n    # treat key IDs as categorical (often better than ordinal)\n    cat_feats = [c for c in [\"state_enc\", \"month\", \"months_since_crop_start\", \"quarter\"] if c in features]\n\n    model = lgb.LGBMRegressor(\n        n_estimators=2500,\n        learning_rate=0.03,\n        num_leaves=63,\n        min_child_samples=25,\n        subsample=0.8,\n        subsample_freq=1,\n        colsample_bytree=0.8,\n        reg_alpha=0.0,\n        reg_lambda=0.5,\n        random_state=42,\n        n_jobs=-1,\n    )\n    model.fit(X, y, categorical_feature=cat_feats)\n\n    pred = model.predict(X_test)\n    pred = np.clip(pred, 0.0, None)\n\n    test_out = test.copy()\n    test_out[\"yield\"] = pred\n    test_out = test_out[[\"year\", \"month\", \"state\", \"yield\"]]\n    out_path = output_path / \"submission.csv\"\n    test_out.to_csv(out_path, index=False)\n    print(f\"Model trained. Submission saved to: {out_path}\")\n    return out_path\n\n# EVOLVE-BLOCK-END\n\ndef main() -> Path:\n    root = r\"D:\\\u6e05\u534e\u5de5\u7a0b\u535a\u58eb\\C3I\\daguan\\agentic-rl\\mle-openevolve\\experiments\\bean03\\inputs\"\n    out_path = train_and_predict(root)\n    return out_path\n\n\nif __name__ == \"__main__\":\n    main()\n", "language": "python", "parent_id": "81550c0c-d7d4-4632-bf1c-ebb6c66a291d", "generation": 2, "timestamp": 1765792870.5020993, "iteration_found": 6, "metrics": {"combined_score": 0.45356018296102407, "mape": 0.10447447762961996, "rmse": 582.9787314982473}, "complexity": 0.0, "diversity": 0.0, "metadata": {"island": 1}, "prompts": null, "artifacts_json": null, "artifact_dir": null, "embedding": null}